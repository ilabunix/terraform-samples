version: 0.2

phases:
  install:
    commands:
      - echo "Installing Packer from repository"
      - cp tools/packer/packer /usr/local/bin/packer
      - chmod +x /usr/local/bin/packer
      - packer --version
      
  pre_build:
    commands:
      - echo "Reading NIT Base AMI name"
      - export BASE_AMI_NAME=$(cat nit_base_ami_name.txt)
      - echo "Base AMI Name = $BASE_AMI_NAME"
      
  build:
    commands:
      - echo "Validating all Packer templates"
      - pwd
      - ls -la packer/
      
      - echo "Validating Silver Authoring template..."
      - packer validate ./packer/bloomreach_silver_authoring_ami.json
      
      - echo "Validating Silver Delivery template..."
      - packer validate ./packer/bloomreach_silver_delivery_ami.json
      
      - echo "Validating Bronze Authoring template..."
      - packer validate ./packer/bloomreach_bronze_authoring_ami.json
      
      - echo "Validating Bronze Delivery template..."
      - packer validate ./packer/bloomreach_bronze_delivery_ami.json
      
      - echo "✅ NIT GOLD AMI --> $BASE_AMI_NAME"
      - echo "✅ All 4 Packer templates validated successfully"
